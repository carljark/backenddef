(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{93:function(t,e,i){"use strict";i.r(e);var s=i(56),a=i(57),h=i(85),r=i(59),n=i(83),o=i(88),l=i(84),c=i(89),m=i(92),p=i(90),d=i(91);var g={date:"%d.%m.%Y",dateTime:"%a %b %e %X %Y",days:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],periods:["AM","PM"],shortDays:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],shortMonths:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],time:"%H:%M:%S"};i.d(e,"GraphLineComponent",function(){return u}),s.timeFormatDefaultLocale(g);class u{constructor(t){this.lineas=t,this.d={price:0,timestamp:new Date},this.bisectDate=s.bisector(t=>t.timestamp).right,this.bisectValue=s.bisector(t=>t.price).right,this.svgWidth=800,this.svgHeight=300,this.margin={top:30,right:40,bottom:50,left:60},this.width=this.svgWidth-this.margin.left-this.margin.right,this.height=this.svgHeight-this.margin.top-this.margin.bottom,this.originalCircle={cx:-150,cy:-15,r:20},this.chartProps={},this.titleGraph="",this.ngOnInit()}removeSvg$(){return Object(h.a)(s.select("svg").remove()).pipe(Object(o.a)(!0))}getLine1(){return new r.a(t=>{this.linea1=this.lineas[0],t.next(this.lineas[0])})}getTitles(){return new r.a(t=>{let e="";this.lineas.forEach(t=>{t.name&&(e=""===e?t.name:e+" / "+t.name)}),this.titleGraph=e,t.next(e)})}ngOnInit(){this.getTitles().pipe(Object(l.a)(t=>this.getLine1()),Object(c.a)(t=>this.defineChart$()),Object(c.a)(t=>Object(n.a)(this.lineas)),Object(l.a)(t=>this.drawLine$(t)),Object(m.a)(1e3),Object(p.a)(t=>this.addToolTips$(t)),Object(p.a)(t=>this.addEventsArea()),Object(d.a)(()=>Object(h.a)("error"))).subscribe(t=>{this.addTitleGraph()})}defineChart$(){return new r.a(t=>{this.defineChart(),t.next(!0)})}defineChart(){this.lineGraphElement=document.getElementById("linechart"),this.svgViewport=s.select(this.lineGraphElement).append("svg").style("background","white").attr("viewBox",`0 0 ${this.svgWidth} ${this.svgHeight}`),this.chartProps.xScale=s.scaleTime().domain(s.extent(this.linea1.timePriceArray,t=>new Date(t.timestamp).getTime())).range([0,this.width]).clamp(!0),this.svgViewport.on("mousedown.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom",null),this.chartProps.yScale=s.scaleLinear().domain([0,s.max(this.lineas,t=>1.1*Math.max(...t.timePriceArray.map(t=>t.price)))]).range([this.height,0]).clamp(!0),this.xAxis=s.axisBottom(this.chartProps.xScale),this.yAxis=s.axisLeft(this.chartProps.yScale),this.zoom=s.zoom().scaleExtent([1,1/0]).translateExtent([[0,0],[this.width,this.height]]).extent([[0,0],[this.width,this.height]]).on("zoom",this.zoomFunction.bind(this)),this.innerSpace=this.svgViewport.append("g").attr("class","inner_space").attr("transform","translate("+this.margin.left+","+this.margin.top+")").call(this.zoom.bind(this));const t=s.timeFormat("%d/%m %H:%M");this.gX=this.innerSpace.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+this.height+")").call(this.xAxis.ticks(6).tickFormat(t)),this.gY=this.innerSpace.append("g").attr("class","axis axis--y").call(this.yAxis),this.originalLine=s.line().x(t=>{if(t.timestamp instanceof Date)return this.chartProps.xScale(t.timestamp.getTime())}).y(t=>this.chartProps.yScale(t.price)),this.scaledLine=s.line().x(t=>{if(t.timestamp instanceof Date)return this.newxScale(t.timestamp.getTime())}).y(t=>this.newyScale(t.price))}addEventsArea(){return new r.a(t=>{this.view=this.innerSpace.append("rect").attr("class","zoom").attr("width",this.width).attr("height",this.height).on("mouseover",this.mouseover.bind(this)).on("mouseout",()=>{this.focus.style("display","none")}).on("mousemove",this.mousemove.bind(this)).on("touchstart",this.touchStart.bind(this)).on("touchmove",this.touchStart.bind(this)).on("touchend",()=>{this.focus.style("display",null)}),t.next(!0)})}drawLine$(t){return new r.a(e=>{this.drawLine(t),e.next(t)})}drawLine(t){t.timePriceArray.forEach(t=>{t.timestamp=a(t.timestamp).toDate()}),this.lineSvg=this.innerSpace.append("path").datum(t.timePriceArray).attr("class","linegraph").style("stroke","black").attr("d",this.originalLine.bind(this)(t.timePriceArray))}zoomFunction(){this.newxScale=s.event.transform.rescaleX(this.chartProps.xScale),this.newyScale=s.event.transform.rescaleY(this.chartProps.yScale),this.gX.call(this.xAxis.scale(this.newxScale)),this.gY.call(this.yAxis.scale(this.newyScale)),this.lineSvg.call(this.xAxis.scale(this.newxScale)),this.lineSvg.call(this.yAxis.scale(this.newyScale)),this.d3eventtransform=s.event.transform,this.changeLine(),this.moveToolTip()}changeLine(){this.lineSvg.attr("d",this.scaledLine.bind(this))}addTitleGraph(){this.titleSvg=this.innerSpace.append("text").attr("x",this.margin.left).attr("y",260).attr("class","graphic_title_text").attr("text-anchor","left").text(this.titleGraph)}addToolTips$(t){return new r.a(e=>{this.addToolTips(t),e.next(!0)})}addToolTips(t){this.focus=this.innerSpace.append("g").attr("class","this.focus").style("display","none"),this.focus.append("line").attr("class","x-hover-line hover-line").attr("y1",0).attr("y2",this.height).attr("pointer-events","none"),this.focus.append("line").attr("class","y-hover-line hover-line").attr("x1",0).attr("x2",this.width).attr("pointer-events","none"),this.focus.append("circle").attr("r",2).attr("pointer-events","none"),this.textToolTip=this.focus.append("text").attr("id","textToolTip").attr("class","text_tooltip").attr("text-anchor","end").attr("y",-20).attr("dy",".31em")}getDataPoint(){if(this.d){return`${a(this.d.timestamp).format("DD/MM HH:mm")}h: ${Math.round(100*this.d.price)/100}€`}return"no data"}touchStart(t,e,i){this.focus.style("display",null),this.mousemove(t,e,i)}mouseover(t,e,i){this.focus.style("display",null),this.mousemove(t,e,i)}mousemove(t,e,i){let a;a=this.newxScale?this.newxScale.invert(s.mouse(i[e])[0]):this.chartProps.xScale.invert(s.mouse(i[e])[0]);const h=this.bisectDate(this.linea1.timePriceArray,a,1),r=this.linea1.timePriceArray[h-1],n=this.linea1.timePriceArray.length;let o;o=h>=this.linea1.timePriceArray.length?this.linea1.timePriceArray[n-1]:this.linea1.timePriceArray[h],this.d=a.getTime()-r.timestamp.getTime()>o.timestamp.getTime()-a.getTime()?o:r,this.moveToolTip()}moveToolTip(){let t;this.newxScale?(this.focus.attr("transform",`translate(${this.newxScale(new Date(this.d.timestamp))},${this.newyScale(this.d.price)})`),t=this.newxScale(new Date(this.d.timestamp))):(this.focus.attr("transform",`translate(${this.chartProps.xScale(new Date(this.d.timestamp))},${this.chartProps.yScale(this.d.price)})`),t=this.chartProps.xScale(new Date(this.d.timestamp))),this.textToolTip.text(this.getDataPoint.bind(this));const e=this.textToolTip.node(),i=e.getBBox();i.width+10>t?this.textToolTip.attr("text-anchor","start"):this.textToolTip.attr("text-anchor","end"),this.focus.selectAll("rect").remove();this.focus.append("rect").attr("x",i.x).attr("y",i.y).attr("width",i.width).attr("height",i.height).style("fill","white").style("fill-opacity",".9").style("stroke","#666").style("stroke-width","0.5px");this.focus.node().insertBefore(e,null);let s=0;s=this.newyScale?this.newyScale(this.d.price):this.chartProps.yScale(this.d.price),this.focus.select(".x-hover-line").attr("y2",this.height-s),this.focus.select(".y-hover-line").attr("x2",-t)}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZDMtdGltZWZvcm1hdGRlZmF1bHRsb2NhbGUudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2QzaGlzdG9yeWdyYXBoLnRzIl0sIm5hbWVzIjpbImQzX3RpbWVmb3JtYXRkZWZhdWx0bG9jYWxlIiwiZGF0ZSIsImRhdGVUaW1lIiwiZGF5cyIsIm1vbnRocyIsInBlcmlvZHMiLCJzaG9ydERheXMiLCJzaG9ydE1vbnRocyIsInRpbWUiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZCIsIl9fd2VicGFja19leHBvcnRzX18iLCJkM2hpc3RvcnlncmFwaF9HcmFwaExpbmVDb21wb25lbnQiLCJleHRlcm5hbF9kM18iLCJbb2JqZWN0IE9iamVjdF0iLCJsaW5lYXMiLCJ0aGlzIiwicHJpY2UiLCJ0aW1lc3RhbXAiLCJEYXRlIiwiYmlzZWN0RGF0ZSIsInJpZ2h0IiwiYmlzZWN0VmFsdWUiLCJzdmdXaWR0aCIsInN2Z0hlaWdodCIsIm1hcmdpbiIsInRvcCIsImJvdHRvbSIsImxlZnQiLCJ3aWR0aCIsImhlaWdodCIsIm9yaWdpbmFsQ2lyY2xlIiwiY3giLCJjeSIsInIiLCJjaGFydFByb3BzIiwidGl0bGVHcmFwaCIsIm5nT25Jbml0IiwiT2JqZWN0Iiwib2YiLCJyZW1vdmUiLCJwaXBlIiwibWFwVG8iLCJPYnNlcnZhYmxlIiwib2IiLCJsaW5lYTEiLCJuZXh0IiwidGl0bGVzIiwiZm9yRWFjaCIsImxpbmRhdGEiLCJuYW1lIiwiZ2V0VGl0bGVzIiwibWVyZ2VNYXAiLCJnZXRMaW5lMSIsInN3aXRjaE1hcCIsImxpbiIsImRlZmluZUNoYXJ0JCIsIm9rIiwiZnJvbSIsImRyYXdMaW5lJCIsImRlbGF5IiwiY29uY2F0TWFwIiwiYWRkVG9vbFRpcHMkIiwiYWRkRXZlbnRzQXJlYSIsImNhdGNoRXJyb3IiLCJzdWJzY3JpYmUiLCJhZGRUaXRsZUdyYXBoIiwiZGVmaW5lQ2hhcnQiLCJsaW5lR3JhcGhFbGVtZW50IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN2Z1ZpZXdwb3J0IiwiYXBwZW5kIiwic3R5bGUiLCJhdHRyIiwieFNjYWxlIiwiZG9tYWluIiwidGltZVByaWNlQXJyYXkiLCJnZXRUaW1lIiwicmFuZ2UiLCJjbGFtcCIsIm9uIiwieVNjYWxlIiwiTWF0aCIsIm1heCIsIm1hcCIsInZhbHVlIiwieEF4aXMiLCJ5QXhpcyIsInpvb20iLCJzY2FsZUV4dGVudCIsIkluZmluaXR5IiwidHJhbnNsYXRlRXh0ZW50IiwiZXh0ZW50Iiwiem9vbUZ1bmN0aW9uIiwiYmluZCIsImlubmVyU3BhY2UiLCJjYWxsIiwiZm9ybWF0RXZlcmQiLCJnWCIsInRpY2tzIiwidGlja0Zvcm1hdCIsImdZIiwib3JpZ2luYWxMaW5lIiwieCIsInkiLCJzY2FsZWRMaW5lIiwibmV3eFNjYWxlIiwibmV3eVNjYWxlIiwidmlldyIsIm1vdXNlb3ZlciIsImZvY3VzIiwibW91c2Vtb3ZlIiwidG91Y2hTdGFydCIsImxpbmUiLCJkcmF3TGluZSIsInBvaW50IiwiZXh0ZXJuYWxfbW9tZW50XyIsInRvRGF0ZSIsImxpbmVTdmciLCJkYXR1bSIsInRyYW5zZm9ybSIsInJlc2NhbGVYIiwicmVzY2FsZVkiLCJzY2FsZSIsImQzZXZlbnR0cmFuc2Zvcm0iLCJjaGFuZ2VMaW5lIiwibW92ZVRvb2xUaXAiLCJ0aXRsZVN2ZyIsInRleHQiLCJhZGRUb29sVGlwcyIsInRleHRUb29sVGlwIiwiZm9ybWF0Iiwicm91bmQiLCJqIiwibm9kZXMiLCJ4MCIsImludmVydCIsImkiLCJkMCIsImFMZW5ndGgiLCJsZW5ndGgiLCJkMSIsImRpc3RhbmNpYXgiLCJnZXREYXRhUG9pbnQiLCJ0eHROb2RlIiwibm9kZSIsImJib3giLCJnZXRCQm94Iiwic2VsZWN0QWxsIiwiaW5zZXJ0QmVmb3JlIiwibmV3eTIiLCJzZWxlY3QiXSwibWFwcGluZ3MiOiI0TEE4Q2UsSUFBQUEsRUE1Q3VDLENBQ2xEQyxLQUFNLFdBQ05DLFNBQVUsaUJBQ1ZDLEtBQU0sQ0FDSixVQUNBLFFBQ0EsU0FD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QUFXd0MsT0FDekIsSUFBSXhELEtBQUtILEtBQUtOLEVBQUVRLGVBQ2ZGLEtBQUttQixXQUFXK0MsT0FBT2xFLEtBQUtOLEVBQUVPLFdBRXZDOEgsRUFBYS9ILEtBQUttQixXQUFXd0MsT0FBTyxJQUFJeEQsS0FBS0gsS0FBS04sRUFBRVEsYUFheERGLEtBQUttSCxZQUNKRixLQUFLakgsS0FBS2dJLGFBQWFqRCxLQUFLL0UsT0FFN0IsTUFBTWlJLEVBQVVqSSxLQUFLbUgsWUFBWWUsT0FFM0JDLEVBQU9GLEVBQVFHLFVBRWpCRCxFQUFLdEgsTUFBUSxHQUFLa0gsRUFDbEIvSCxLQUFLbUgsWUFDSnpELEtBQUssY0FBZSxTQUVyQjFELEtBQUttSCxZQUNKekQsS0FBSyxjQUFlLE9BR3pCMUQsS0FBSytGLE1BQU1zQyxVQUFVLFFBQVE3RyxTQUVoQnhCLEtBQUsrRixNQUNidkMsT0FBTyxRQUNQRSxLQUFLLElBQUt5RSxFQUFLM0MsR0FDZjlCLEtBQUssSUFBS3lFLEVBQUsxQyxHQUNmL0IsS0FBSyxRQUFTeUUsRUFBS3RILE9BQ25CNkMsS0FBSyxTQUFVeUUsRUFBS3JILFFBQ3BCMkMsTUFBTSxPQUFRLFNBQ2RBLE1BQU0sZUFBZ0IsTUFDdEJBLE1BQU0sU0FBVSxRQUNoQkEsTUFBTSxlQUFnQixTQUUzQnpELEtBQUsrRixNQUFNbUMsT0FBT0ksYUFBYUwsRUFBUyxNQUV4QyxJQUFJTSxFQUFRLEVBR1JBLEVBREF2SSxLQUFLNEYsVUFDRzVGLEtBQUs0RixVQUFVNUYsS0FBS04sRUFBRU8sT0FFdEJELEtBQUttQixXQUFXK0MsT0FBT2xFLEtBQUtOLEVBQUVPLE9BSzFDRCxLQUFLK0YsTUFDQXlDLE9BQU8saUJBQ1A5RSxLQUFLLEtBQU0xRCxLQUFLYyxPQUFTeUgsR0FHOUJ2SSxLQUFLK0YsTUFBTXlDLE9BQU8saUJBQWlCOUUsS0FBSyxNQUFRcUUiLCJmaWxlIjoiZDNoaXN0b3J5Z3JhcGguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUaW1lTG9jYWxlRGVmaW5pdGlvbiB9IGZyb20gJ2QzJztcblxuY29uc3QgdGltZWZvcm1hdGRlZmF1bHRsb2NhbGU6IFRpbWVMb2NhbGVEZWZpbml0aW9uID0ge1xuICAgIGRhdGU6ICclZC4lbS4lWScsXG4gICAgZGF0ZVRpbWU6ICclYSAlYiAlZSAlWCAlWScsXG4gICAgZGF5czogW1xuICAgICAgJ0RvbWluZ28nLFxuICAgICAgJ0x1bmVzJyxcbiAgICAgICdNYXJ0ZXMnLFxuICAgICAgJ01pw6lyY29sZXMnLFxuICAgICAgJ0p1ZXZlcycsXG4gICAgICAnVmllcm5lcycsXG4gICAgICAnU8OhYmFkbycsXG4gICAgXSxcbiAgICBtb250aHM6IFtcbiAgICAgICAgJ0VuZXJvJyxcbiAgICAgICAgJ0ZlYnJlcm8nLFxuICAgICAgICAnTWFyem8nLFxuICAgICAgICAnQWJyaWwnLFxuICAgICAgICAnTWF5bycsXG4gICAgICAgICdKdW5pbycsXG4gICAgICAgICdKdWxpbycsXG4gICAgICAgICdBZ29zdG8nLFxuICAgICAgICAnU2VwdGllbWJyZScsXG4gICAgICAgICdPY3R1YnJlJyxcbiAgICAgICAgJ05vdmllbWJyZScsXG4gICAgICAgICdEaWNpZW1icmUnLFxuICAgIF0sXG4gICAgcGVyaW9kczogWydBTScsICdQTSddLFxuICAgIHNob3J0RGF5czogWydEbycsICdMdScsICdNYScsICdNaScsICdKdScsICdWaScsICdTYSddLFxuICAgIHNob3J0TW9udGhzOiBbXG4gICAgICAgICdFbmUnLFxuICAgICAgICAnRmViJyxcbiAgICAgICAgJ01hcicsXG4gICAgICAgICdBYnInLFxuICAgICAgICAnTWF5JyxcbiAgICAgICAgJ0p1bicsXG4gICAgICAgICdKdWwnLFxuICAgICAgICAnQWdvJyxcbiAgICAgICAgJ1NlcCcsXG4gICAgICAgICdPY3QnLFxuICAgICAgICAnTm92JyxcbiAgICAgICAgJ0RpYycsXG4gICAgXSxcbiAgICB0aW1lOiAnJUg6JU06JVMnLFxufTtcbmV4cG9ydCBkZWZhdWx0IHRpbWVmb3JtYXRkZWZhdWx0bG9jYWxlO1xuIiwiaW1wb3J0ICogYXMgZDMgZnJvbSAnZDMnO1xuaW1wb3J0ICogYXMgbW9tZW50IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgeyBmcm9tLCBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciwgY29uY2F0TWFwLCBkZWxheSwgbWFwVG8sIG1lcmdlTWFwLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgSUNvaW5IaXN0b3J5IGZyb20gJy4vY29pbi1oaXN0b3J5LmludGVyZmFjZSc7XG5pbXBvcnQgdGltZUZvcm1hdERlZmF1bHRMb2NhbGUgZnJvbSAnLi9kMy10aW1lZm9ybWF0ZGVmYXVsdGxvY2FsZSc7XG5pbXBvcnQgSVRpbWVQcmljZSBmcm9tICcuL3RpbWVwcmljZS5pbnRlcmZhY2UnO1xuXG5kMy50aW1lRm9ybWF0RGVmYXVsdExvY2FsZSh0aW1lRm9ybWF0RGVmYXVsdExvY2FsZSk7XG5cbmludGVyZmFjZSBJU2NhbGVzIHtcbiAgeFNjYWxlOiBkMy5TY2FsZVRpbWU8bnVtYmVyLCBudW1iZXI+O1xuICB5U2NhbGU6IGQzLlNjYWxlTGluZWFyPG51bWJlciwgbnVtYmVyPjtcbn1cblxuZXhwb3J0IGNsYXNzIEdyYXBoTGluZUNvbXBvbmVudCB7XG4gICAgcHVibGljIGQ6IElUaW1lUHJpY2UgPSB7cHJpY2U6IDAsIHRpbWVzdGFtcDogbmV3IERhdGUoKX07XG4gICAgcHVibGljIHBhblg6IGFueTtcbiAgICBwdWJsaWMgcGFuWTogYW55O1xuICAgIHB1YmxpYyBzY2FsZU11bHRpcGxpZXI6IGFueTtcbiAgICAvLyBwdWJsaWMgZDNldmVudHRyYW5zZm9ybTogYW55ID0geyBrOiAxLCB4OiAwLCB5OiAwIH07XG4gICAgcHVibGljIGQzZXZlbnR0cmFuc2Zvcm06IGFueTtcbiAgICAvLyBwdWJsaWMgbmV3eVNjYWxlOiBkMy5BeGlzU2NhbGU8bnVtYmVyIHwgeyB2YWx1ZU9mKCk6IG51bWJlcjsgfT47XG4gICAgLy8gcHVibGljIG5ld3hTY2FsZTogZDMuQXhpc1NjYWxlPG51bWJlciB8IHsgdmFsdWVPZigpOiBudW1iZXI7IH0+O1xuICAgIHB1YmxpYyBuZXd5U2NhbGU6IGFueTsgLy8gYXNpZ25hciBlbiBlbCBjb250cnVjdG9yIG8gZXF1aXZhbGVudGVcbiAgICBwdWJsaWMgbmV3eFNjYWxlOiBhbnk7XG4gICAgcHVibGljIGJpc2VjdERhdGUgPSBkMy5iaXNlY3RvcigoZDogSVRpbWVQcmljZSkgPT4gZC50aW1lc3RhbXApLnJpZ2h0O1xuICAgIHB1YmxpYyBiaXNlY3RWYWx1ZSA9IGQzLmJpc2VjdG9yKChkOiBJVGltZVByaWNlKSA9PiBkLnByaWNlKS5yaWdodDtcbiAgICBwdWJsaWMgc3ZnV2lkdGggPSA4MDA7XG4gICAgcHVibGljIHN2Z0hlaWdodCA9IDMwMDtcbiAgICBwdWJsaWMgbWFyZ2luID0geyB0b3A6IDMwLCByaWdodDogNDAsIGJvdHRvbTogNTAsIGxlZnQ6IDYwIH07XG4gICAgcHVibGljIHdpZHRoID0gdGhpcy5zdmdXaWR0aCAtIHRoaXMubWFyZ2luLmxlZnQgLSB0aGlzLm1hcmdpbi5yaWdodDtcbiAgICBwdWJsaWMgaGVpZ2h0ID0gdGhpcy5zdmdIZWlnaHQgLSB0aGlzLm1hcmdpbi50b3AgLSB0aGlzLm1hcmdpbi5ib3R0b207XG4gICAgcHVibGljIG9yaWdpbmFsTGluZTogZDMuTGluZTxJVGltZVByaWNlPjtcbiAgICBwdWJsaWMgc2NhbGVkTGluZTogZDMuTGluZTxJVGltZVByaWNlPjtcbiAgICBwdWJsaWMgb3JpZ2luYWxDaXJjbGUgPSB7XG4gICAgY3g6IC0xNTAsXG4gICAgY3k6IC0xNSxcbiAgICByOiAyMCxcbiAgICB9O1xuICAgIHB1YmxpYyBjaGFydFByb3BzID0ge30gYXMgSVNjYWxlcztcbiAgICBwdWJsaWMgZ1g6IGQzLlNlbGVjdGlvbjxTVkdHRWxlbWVudCwge30sIG51bGwsIHVuZGVmaW5lZD47XG4gICAgcHVibGljIGdZOiBkMy5TZWxlY3Rpb248U1ZHR0VsZW1lbnQsIHt9LCBudWxsLCB1bmRlZmluZWQ+O1xuICAgIHB1YmxpYyBsaW5lU3ZnOiBkMy5TZWxlY3Rpb248U1ZHR0VsZW1lbnQsIHt9LCBudWxsLCB1bmRlZmluZWQ+O1xuICAgIHB1YmxpYyB2aWV3OiBkMy5TZWxlY3Rpb248U1ZHR0VsZW1lbnQsIHt9LCBudWxsLCB1bmRlZmluZWQ+O1xuICAgIHB1YmxpYyBpbm5lclNwYWNlOiBkMy5TZWxlY3Rpb248U1ZHR0VsZW1lbnQsIHt9LCBudWxsLCB1bmRlZmluZWQ+O1xuICAgIHB1YmxpYyBzdmdWaWV3cG9ydDogZDMuU2VsZWN0aW9uPFNWR0dFbGVtZW50LCB7fSwgbnVsbCwgdW5kZWZpbmVkPjtcbiAgICBwdWJsaWMgdGl0bGVTdmc6IGQzLlNlbGVjdGlvbjxTVkdHRWxlbWVudCwge30sIG51bGwsIHVuZGVmaW5lZD47XG4gICAgcHVibGljIGZvY3VzOiBkMy5TZWxlY3Rpb248U1ZHR0VsZW1lbnQsIHt9LCBudWxsLCB1bmRlZmluZWQ+O1xuICAgIHB1YmxpYyB0ZXh0VG9vbFRpcDogZDMuU2VsZWN0aW9uPFNWR1RleHRFbGVtZW50LCB7fSwgbnVsbCwgdW5kZWZpbmVkPjtcbiAgICBwdWJsaWMgem9vbTogZDMuWm9vbUJlaGF2aW9yPEVsZW1lbnQsIHt9PjtcbiAgICBwdWJsaWMgeEF4aXM6IGQzLkF4aXM8bnVtYmVyIHwgeyB2YWx1ZU9mKCk6IG51bWJlciB9PjtcbiAgICBwdWJsaWMgeUF4aXM6IGQzLkF4aXM8bnVtYmVyIHwgeyB2YWx1ZU9mKCk6IG51bWJlciB9PjtcbiAgICBwdWJsaWMgbGluZUdyYXBoRWxlbWVudDogSFRNTEVsZW1lbnQ7XG4gICAgcHVibGljIGxpbmVhMTogSUNvaW5IaXN0b3J5O1xuICAgIHB1YmxpYyB0aXRsZUdyYXBoID0gJyc7XG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHB1YmxpYyBsaW5lYXM6IElDb2luSGlzdG9yeVtdLFxuICAgICkge1xuICAgICAgICB0aGlzLm5nT25Jbml0KCk7XG4gICAgfVxuICAgIHB1YmxpYyByZW1vdmVTdmckKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgICAgICByZXR1cm4gb2YoZDMuc2VsZWN0KCdzdmcnKS5yZW1vdmUoKSlcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBtYXBUbyh0cnVlKSxcbiAgICAgICAgKTtcbiAgICB9XG4gICAgcHVibGljIGdldExpbmUxKCk6IE9ic2VydmFibGU8SUNvaW5IaXN0b3J5PiB7XG4gICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZTxJQ29pbkhpc3Rvcnk+KChvYikgPT4ge1xuICAgICAgICAgICAgdGhpcy5saW5lYTEgPSB0aGlzLmxpbmVhc1swXTtcbiAgICAgICAgICAgIG9iLm5leHQodGhpcy5saW5lYXNbMF0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0VGl0bGVzKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZTxzdHJpbmc+KChvYikgPT4ge1xuICAgICAgICAgICAgbGV0IHRpdGxlcyA9ICcnO1xuICAgICAgICAgICAgdGhpcy5saW5lYXMuZm9yRWFjaCgobGluZGF0YSkgPT4ge1xuICAgICAgICAgICAgaWYgKGxpbmRhdGEubmFtZSkge1xuICAgICAgICAgICAgICAgIGlmICh0aXRsZXMgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgdGl0bGVzID0gbGluZGF0YS5uYW1lO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGl0bGVzID0gdGl0bGVzICsgJyAvICcgKyBsaW5kYXRhLm5hbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnRpdGxlR3JhcGggPSB0aXRsZXM7XG4gICAgICAgICAgICBvYi5uZXh0KHRpdGxlcyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBuZ09uSW5pdCgpIHtcblxuICAgICAgICAvKiB0aGlzLnJlbW92ZVN2ZyQoKVxuICAgICAgICAucGlwZShzd2l0Y2hNYXAoKG9rKSA9PiB0aGlzLmdldFRpdGxlcygpKVxuICAgICAgICApICovXG4gICAgICAgIHRoaXMuZ2V0VGl0bGVzKClcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBtZXJnZU1hcCgodGl0bGVzKSA9PiB0aGlzLmdldExpbmUxKCkpLFxuICAgICAgICAgICAgc3dpdGNoTWFwKChsaW4pID0+IHRoaXMuZGVmaW5lQ2hhcnQkKCkpLFxuICAgICAgICAgICAgc3dpdGNoTWFwKChvaykgPT4gZnJvbSh0aGlzLmxpbmVhcykpLFxuICAgICAgICAgICAgbWVyZ2VNYXAoKGxpbikgPT4gdGhpcy5kcmF3TGluZSQobGluKSksXG4gICAgICAgICAgICBkZWxheSgxMDAwKSxcbiAgICAgICAgICAgIGNvbmNhdE1hcCgobGluKSA9PiB0aGlzLmFkZFRvb2xUaXBzJChsaW4pKSxcbiAgICAgICAgICAgIGNvbmNhdE1hcCgobGluKSA9PiB0aGlzLmFkZEV2ZW50c0FyZWEoKSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKCgpID0+IG9mKCdlcnJvcicpKSxcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKChvaykgPT4ge1xuICAgICAgICB0aGlzLmFkZFRpdGxlR3JhcGgoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHB1YmxpYyBkZWZpbmVDaGFydCQoKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZTxib29sZWFuPigob2IpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGVmaW5lQ2hhcnQoKTtcbiAgICAgICAgICAgIG9iLm5leHQodHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBwdWJsaWMgZGVmaW5lQ2hhcnQoKSB7XG4gICAgICAgIHRoaXMubGluZUdyYXBoRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaW5lY2hhcnQnKTtcbiAgICAgICAgdGhpcy5zdmdWaWV3cG9ydCA9IGQzXG4gICAgICAgIC5zZWxlY3QodGhpcy5saW5lR3JhcGhFbGVtZW50KVxuICAgICAgICAuYXBwZW5kKCdzdmcnKVxuICAgICAgICAuc3R5bGUoJ2JhY2tncm91bmQnLCAnd2hpdGUnKVxuICAgICAgICAuYXR0cigndmlld0JveCcsIGAwIDAgJHt0aGlzLnN2Z1dpZHRofSAke3RoaXMuc3ZnSGVpZ2h0fWApO1xuICAgICAgICB0aGlzLmNoYXJ0UHJvcHMueFNjYWxlID0gZDNcbiAgICAgICAgLnNjYWxlVGltZSgpXG4gICAgICAgIC5kb21haW4oZDMuZXh0ZW50KHRoaXMubGluZWExLnRpbWVQcmljZUFycmF5LCAoZCkgPT4gbmV3IERhdGUoZC50aW1lc3RhbXApLmdldFRpbWUoKSkpXG4gICAgICAgIC5yYW5nZShbMCwgdGhpcy53aWR0aF0pXG4gICAgICAgIC5jbGFtcCh0cnVlKTtcblxuICAgICAgICAvLyBkZXNhY3Rpdm8gZWwgem9vbSBkZWwgc3ZnIHBhcmEgcXVlXG4gICAgICAgIC8vIG5vIGludGVyZmllcmEgY29uIGVsIHpvb20gZGVsIGxpbmVzdmdcbiAgICAgICAgdGhpcy5zdmdWaWV3cG9ydC5vbignbW91c2Vkb3duLnpvb20nLCBudWxsKVxuICAgICAgICAub24oJ3RvdWNoc3RhcnQuem9vbScsIG51bGwpXG4gICAgICAgIC5vbigndG91Y2htb3ZlLnpvb20nLCBudWxsKVxuICAgICAgICAub24oJ3RvdWNoZW5kLnpvb20nLCBudWxsKTtcblxuICAgICAgICB0aGlzLmNoYXJ0UHJvcHMueVNjYWxlID0gZDNcbiAgICAgICAgLnNjYWxlTGluZWFyKClcbiAgICAgICAgLmRvbWFpbihbXG4gICAgICAgICAgICAwLFxuICAgICAgICAgICAgZDMubWF4KFxuICAgICAgICAgICAgICAgIHRoaXMubGluZWFzLFxuICAgICAgICAgICAgICAgIChkKSA9PiBNYXRoLm1heCguLi5kLnRpbWVQcmljZUFycmF5Lm1hcCgodmFsdWUpID0+IHZhbHVlLnByaWNlKSkgKiAxLjEsXG4gICAgICAgICAgICApLFxuICAgICAgICBdKVxuICAgICAgICAucmFuZ2UoW3RoaXMuaGVpZ2h0LCAwXSlcbiAgICAgICAgLmNsYW1wKHRydWUpO1xuXG4gICAgICAgIHRoaXMueEF4aXMgPSBkMy5heGlzQm90dG9tKHRoaXMuY2hhcnRQcm9wcy54U2NhbGUpO1xuICAgICAgICB0aGlzLnlBeGlzID0gZDMuYXhpc0xlZnQodGhpcy5jaGFydFByb3BzLnlTY2FsZSk7XG4gICAgICAgIHRoaXMuem9vbSA9IGQzLnpvb20oKVxuICAgICAgICAuc2NhbGVFeHRlbnQoWzEsIEluZmluaXR5XSlcbiAgICAgICAgLnRyYW5zbGF0ZUV4dGVudChbWzAsIDBdLCBbdGhpcy53aWR0aCwgdGhpcy5oZWlnaHRdXSlcbiAgICAgICAgLmV4dGVudChbWzAsIDBdLCBbdGhpcy53aWR0aCwgdGhpcy5oZWlnaHRdXSlcbiAgICAgICAgLm9uKCd6b29tJywgdGhpcy56b29tRnVuY3Rpb24uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgdGhpcy5pbm5lclNwYWNlID0gdGhpcy5zdmdWaWV3cG9ydFxuICAgICAgICAuYXBwZW5kKCdnJylcbiAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2lubmVyX3NwYWNlJylcbiAgICAgICAgLmF0dHIoXG4gICAgICAgICd0cmFuc2Zvcm0nLFxuICAgICAgICAndHJhbnNsYXRlKCcgKyB0aGlzLm1hcmdpbi5sZWZ0ICsgJywnICsgdGhpcy5tYXJnaW4udG9wICsgJyknLFxuICAgICAgICApXG4gICAgICAgIC5jYWxsKHRoaXMuem9vbS5iaW5kKHRoaXMpKTtcbiAgICAgICAgY29uc3QgZm9ybWF0RXZlcmQgPSBkMy50aW1lRm9ybWF0KCclZC8lbSAlSDolTScpO1xuICAgICAgICB0aGlzLmdYID0gdGhpcy5pbm5lclNwYWNlXG4gICAgICAgICAgICAuYXBwZW5kKCdnJylcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdheGlzIGF4aXMtLXgnKVxuICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoMCwnICsgdGhpcy5oZWlnaHQgKyAnKScpXG4gICAgICAgICAgICAuY2FsbCh0aGlzLnhBeGlzLnRpY2tzKDYpLnRpY2tGb3JtYXQoZm9ybWF0RXZlcmQpKTtcblxuICAgICAgICB0aGlzLmdZID0gdGhpcy5pbm5lclNwYWNlXG4gICAgICAgICAgICAuYXBwZW5kKCdnJylcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdheGlzIGF4aXMtLXknKVxuICAgICAgICAgICAgLmNhbGwodGhpcy55QXhpcyk7XG5cbiAgICAgICAgdGhpcy5vcmlnaW5hbExpbmUgPSBkM1xuICAgICAgICAgICAgLmxpbmU8SVRpbWVQcmljZT4oKVxuICAgICAgICAgICAgLngoKGQpID0+IHtcbiAgICAgICAgICAgIGlmIChkLnRpbWVzdGFtcCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnZC5kYXRlOiAnLCBkLmRhdGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoYXJ0UHJvcHMueFNjYWxlKGQudGltZXN0YW1wLmdldFRpbWUoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnkoKGQpID0+IHRoaXMuY2hhcnRQcm9wcy55U2NhbGUoZC5wcmljZSkpO1xuXG4gICAgICAgIHRoaXMuc2NhbGVkTGluZSA9IGQzXG4gICAgICAgIC5saW5lPElUaW1lUHJpY2U+KClcbiAgICAgICAgLngoKGQpID0+IHtcbiAgICAgICAgaWYgKGQudGltZXN0YW1wIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2QuZGF0ZTogJywgZC5kYXRlKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm5ld3hTY2FsZShkLnRpbWVzdGFtcC5nZXRUaW1lKCkpO1xuICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC55KChkKSA9PiB0aGlzLm5ld3lTY2FsZShkLnByaWNlKSk7XG4gICAgfVxuICAgIHB1YmxpYyBhZGRFdmVudHNBcmVhKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGU8Ym9vbGVhbj4oKG9iKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnZpZXcgPSB0aGlzLmlubmVyU3BhY2VcbiAgICAgICAgICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ3pvb20nKVxuICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgdGhpcy53aWR0aClcbiAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCB0aGlzLmhlaWdodClcbiAgICAgICAgICAgIC5vbignbW91c2VvdmVyJywgdGhpcy5tb3VzZW92ZXIuYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5mb2N1cy5zdHlsZSgnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKCdtb3VzZW1vdmUnLCB0aGlzLm1vdXNlbW92ZS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLm9uKCd0b3VjaHN0YXJ0JywgdGhpcy50b3VjaFN0YXJ0LmJpbmQodGhpcykpXG4gICAgICAgICAgICAub24oJ3RvdWNobW92ZScsIHRoaXMudG91Y2hTdGFydC5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLm9uKCd0b3VjaGVuZCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmZvY3VzLnN0eWxlKCdkaXNwbGF5JywgbnVsbCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgb2IubmV4dCh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHB1YmxpYyBkcmF3TGluZSQobGluZTogSUNvaW5IaXN0b3J5KSB7XG4gICAgICByZXR1cm4gbmV3IE9ic2VydmFibGU8SUNvaW5IaXN0b3J5Pigob2IpID0+IHtcbiAgICAgICAgICB0aGlzLmRyYXdMaW5lKGxpbmUpO1xuICAgICAgICAgIG9iLm5leHQobGluZSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcHVibGljIGRyYXdMaW5lKGxpbmU6IElDb2luSGlzdG9yeSkge1xuICAgICAgICBsaW5lLnRpbWVQcmljZUFycmF5LmZvckVhY2goKHBvaW50KSA9PiB7XG4gICAgICAgICAgICBwb2ludC50aW1lc3RhbXAgPSBtb21lbnQocG9pbnQudGltZXN0YW1wKS50b0RhdGUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubGluZVN2ZyA9IHRoaXMuaW5uZXJTcGFjZVxuICAgICAgICAgICAgLmFwcGVuZCgncGF0aCcpXG4gICAgICAgICAgICAuZGF0dW0obGluZS50aW1lUHJpY2VBcnJheSlcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdsaW5lZ3JhcGgnKVxuICAgICAgICAgICAgLy8gLnN0eWxlKCdzdHJva2UnLCBjb2xvcl9jb2RlKSAvLyBhw7FhZGlyIGFxdcOtIGVsIGNvbG9yIHF1ZSB2aWVuZSBkZSBsb3MgZGF0b3MgZGUgbGEgbGluZWFcbiAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgJ2JsYWNrJylcbiAgICAgICAgICAgIC5hdHRyKCdkJywgdGhpcy5vcmlnaW5hbExpbmUuYmluZCh0aGlzKShsaW5lLnRpbWVQcmljZUFycmF5KSk7XG4gICAgfVxuICAgIHB1YmxpYyB6b29tRnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMubmV3eFNjYWxlID0gZDMuZXZlbnQudHJhbnNmb3JtLnJlc2NhbGVYKHRoaXMuY2hhcnRQcm9wcy54U2NhbGUpO1xuICAgICAgICB0aGlzLm5ld3lTY2FsZSA9IGQzLmV2ZW50LnRyYW5zZm9ybS5yZXNjYWxlWSh0aGlzLmNoYXJ0UHJvcHMueVNjYWxlKTtcbiAgICAgICAgLy8gdXBkYXRlIGF4ZXNcbiAgICAgICAgdGhpcy5nWC5jYWxsKHRoaXMueEF4aXMuc2NhbGUodGhpcy5uZXd4U2NhbGUpKTtcbiAgICAgICAgdGhpcy5nWS5jYWxsKHRoaXMueUF4aXMuc2NhbGUodGhpcy5uZXd5U2NhbGUpKTtcbiAgICAgICAgdGhpcy5saW5lU3ZnLmNhbGwodGhpcy54QXhpcy5zY2FsZSh0aGlzLm5ld3hTY2FsZSkpO1xuICAgICAgICB0aGlzLmxpbmVTdmcuY2FsbCh0aGlzLnlBeGlzLnNjYWxlKHRoaXMubmV3eVNjYWxlKSk7XG5cbiAgICAgICAgdGhpcy5kM2V2ZW50dHJhbnNmb3JtID0gZDMuZXZlbnQudHJhbnNmb3JtO1xuICAgICAgICAvLyB0aGlzLmxpbmVTdmcuYXR0cigndHJhbnNmb3JtJywgdGhpcy5kM2V2ZW50dHJhbnNmb3JtKTtcblxuICAgICAgICAvLyB0aGlzLmNoYXJ0UHJvcHMueFNjYWxlLmRvbWFpbihuZXdEb21haW5YKTtcbiAgICAgICAgLy8gdGhpcy5jaGFydFByb3BzLnlTY2FsZS5kb21haW4oZDMuZXZlbnQudHJhbnNmb3JtLnJlc2NhbGVZKHRoaXMuY2hhcnRQcm9wcy55U2NhbGUuZG9tYWluKCkpKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ3NlIGVzY2FsYScpO1xuXG4gICAgICAgIHRoaXMuY2hhbmdlTGluZSgpO1xuXG4gICAgICAgIHRoaXMubW92ZVRvb2xUaXAoKTtcblxuICAgIH1cblxuICAgIHB1YmxpYyBjaGFuZ2VMaW5lKCkge1xuICAgICAgICB0aGlzLmxpbmVTdmdcbiAgICAgICAgLmF0dHIoJ2QnLCB0aGlzLnNjYWxlZExpbmUuYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgLy8gY3JlYW1vcyBsYXMgZnVuY2lvbmVzIHF1ZSBjcmVhbiBsb3MgY2lyY3Vsb3MgeSBsb3MgdG9vbHRpcHNcblxuICAgIHB1YmxpYyBhZGRUaXRsZUdyYXBoKCkge1xuICAgICAgLy8gZXN0ZSBlcyBlbCB0w610dWxvIHF1ZSBkZWJlcsOtYSBhcGFyZWNlciBkZWJham8gZGUgbGEgZ3LDoWZpY2FcbiAgICAgIC8vIGNvcnJlZ2ltb3MgZWwgbWFyZ2VuIHRvcFxuICAgICAgLy8gY29uc3QgZGlzdFRleHRUb3AgPSB0aGlzLmhlaWdodCArIHRoaXMubWFyZ2luLnRvcDtcbiAgICAgIGNvbnN0IGRpc3RUZXh0VG9wID0gMjYwO1xuICAgICAgLy8gY29uc29sZS5sb2coJ2Rpc3RUZXh0VG9wOiAnLCBkaXN0VGV4dFRvcCk7XG4gICAgICB0aGlzLnRpdGxlU3ZnID0gdGhpcy5pbm5lclNwYWNlXG4gICAgICAuYXBwZW5kKCd0ZXh0JylcbiAgICAgIC5hdHRyKCd4JywgdGhpcy5tYXJnaW4ubGVmdClcbiAgICAgIC8vIC5hdHRyKCd5JywgMCAtIHRoaXMubWFyZ2luLnRvcCAvIDQpXG4gICAgICAuYXR0cigneScsIGRpc3RUZXh0VG9wKVxuICAgICAgLmF0dHIoJ2NsYXNzJywgJ2dyYXBoaWNfdGl0bGVfdGV4dCcpXG4gICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbGVmdCcpXG4gICAgICAudGV4dCh0aGlzLnRpdGxlR3JhcGgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhZGRUb29sVGlwcyQobGluZTogSUNvaW5IaXN0b3J5KTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlPGJvb2xlYW4+KChvYikgPT4ge1xuICAgICAgICB0aGlzLmFkZFRvb2xUaXBzKGxpbmUpO1xuICAgICAgICBvYi5uZXh0KHRydWUpO1xuICAgIH0pO1xuICAgIH1cbiAgICBwdWJsaWMgYWRkVG9vbFRpcHMobGluZTogSUNvaW5IaXN0b3J5KSB7XG4gICAgICAgIHRoaXMuZm9jdXMgPSB0aGlzLmlubmVyU3BhY2VcbiAgICAgICAgLmFwcGVuZCgnZycpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICd0aGlzLmZvY3VzJylcbiAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcblxuICAgICAgICB0aGlzLmZvY3VzXG4gICAgICAgIC5hcHBlbmQoJ2xpbmUnKVxuICAgICAgICAuYXR0cignY2xhc3MnLCAneC1ob3Zlci1saW5lIGhvdmVyLWxpbmUnKVxuICAgICAgICAuYXR0cigneTEnLCAwKVxuICAgICAgICAuYXR0cigneTInLCB0aGlzLmhlaWdodClcbiAgICAgICAgLmF0dHIoJ3BvaW50ZXItZXZlbnRzJywgJ25vbmUnKTtcblxuICAgICAgICB0aGlzLmZvY3VzXG4gICAgICAgIC5hcHBlbmQoJ2xpbmUnKVxuICAgICAgICAuYXR0cignY2xhc3MnLCAneS1ob3Zlci1saW5lIGhvdmVyLWxpbmUnKVxuICAgICAgICAuYXR0cigneDEnLCAwKVxuICAgICAgICAuYXR0cigneDInLCB0aGlzLndpZHRoKVxuICAgICAgICAuYXR0cigncG9pbnRlci1ldmVudHMnLCAnbm9uZScpO1xuXG4gICAgICAgIHRoaXMuZm9jdXNcbiAgICAgICAgLmFwcGVuZCgnY2lyY2xlJylcbiAgICAgICAgLmF0dHIoJ3InLCAyKVxuICAgICAgICAuYXR0cigncG9pbnRlci1ldmVudHMnLCAnbm9uZScpO1xuXG4gICAgICAgIHRoaXMudGV4dFRvb2xUaXAgPSB0aGlzLmZvY3VzXG4gICAgICAgIC5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAuYXR0cignaWQnLCAndGV4dFRvb2xUaXAnKVxuICAgICAgICAuYXR0cignY2xhc3MnLCAndGV4dF90b29sdGlwJylcbiAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ2VuZCcpXG4gICAgICAgIC5hdHRyKCd5JywgLTIwKVxuICAgICAgICAuYXR0cignZHknLCAnLjMxZW0nKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0RGF0YVBvaW50KCk6IHN0cmluZyB7XG4gICAgICAgIGlmICh0aGlzLmQpIHtcbiAgICAgICAgICAgIGNvbnN0IGhvcmEgPSBtb21lbnQodGhpcy5kLnRpbWVzdGFtcCkuZm9ybWF0KCdERC9NTSBISDptbScpO1xuICAgICAgICAgICAgY29uc3QgcHJlY2lvUmVkb25kZWFkbyA9IE1hdGgucm91bmQodGhpcy5kLnByaWNlICogMTAwKSAvIDEwMDtcbiAgICAgICAgICAgIHJldHVybiBgJHtob3JhfWg6ICR7cHJlY2lvUmVkb25kZWFkb33igqxgO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICdubyBkYXRhJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyB0b3VjaFN0YXJ0KGRhdHVtOiBhbnksIGo6IGFueSwgbm9kZXM6IGFueSkge1xuICAgICAgICB0aGlzLmZvY3VzLnN0eWxlKCdkaXNwbGF5JywgbnVsbCk7XG4gICAgICAgIHRoaXMubW91c2Vtb3ZlKGRhdHVtLCBqLCBub2Rlcyk7XG4gICAgfVxuXG4gICAgcHVibGljIG1vdXNlb3ZlcihkYXR1bTogYW55LCBqOiBhbnksIG5vZGVzOiBhbnkpIHtcbiAgICAgICAgdGhpcy5mb2N1cy5zdHlsZSgnZGlzcGxheScsIG51bGwpO1xuICAgICAgICB0aGlzLm1vdXNlbW92ZShkYXR1bSwgaiwgbm9kZXMpO1xuICAgIH1cblxuICAgIHB1YmxpYyBtb3VzZW1vdmUoZGF0dW06IGFueSwgajogYW55LCBub2RlczogYW55KSB7XG4gICAgICAgIGxldCB4MDtcbiAgICAgICAgaWYgKHRoaXMubmV3eFNjYWxlKSB7XG4gICAgICAgICAgICB4MCA9IHRoaXMubmV3eFNjYWxlLmludmVydChkMy5tb3VzZShub2Rlc1tqXSlbMF0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgeDAgPSB0aGlzLmNoYXJ0UHJvcHMueFNjYWxlLmludmVydChkMy5tb3VzZShub2Rlc1tqXSlbMF0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGkgPSB0aGlzLmJpc2VjdERhdGUodGhpcy5saW5lYTEudGltZVByaWNlQXJyYXksIHgwLCAxKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ2k6ICcsIGkpO1xuXG4gICAgICAgIGNvbnN0IGQwID0gdGhpcy5saW5lYTEudGltZVByaWNlQXJyYXlbaSAtIDFdO1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnZDA6ICcsIGQwKTtcblxuICAgICAgICBjb25zdCBhTGVuZ3RoID0gdGhpcy5saW5lYTEudGltZVByaWNlQXJyYXkubGVuZ3RoO1xuICAgICAgICBsZXQgZDE6IElUaW1lUHJpY2U7XG4gICAgICAgIGlmIChpID49IHRoaXMubGluZWExLnRpbWVQcmljZUFycmF5Lmxlbmd0aCkge1xuICAgICAgICAgICAgZDEgPSB0aGlzLmxpbmVhMS50aW1lUHJpY2VBcnJheVthTGVuZ3RoIC0gMV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkMSA9IHRoaXMubGluZWExLnRpbWVQcmljZUFycmF5W2ldO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdkMTogJywgZDEpO1xuXG4gICAgICAgIHRoaXMuZCA9XG4gICAgICAgICAgICB4MC5nZXRUaW1lKCkgLSAoZDAudGltZXN0YW1wIGFzIERhdGUpLmdldFRpbWUoKSA+XG4gICAgICAgICAgICAoZDEudGltZXN0YW1wIGFzIERhdGUpLmdldFRpbWUoKSAtIHgwLmdldFRpbWUoKVxuICAgICAgICAgICAgPyBkMVxuICAgICAgICAgICAgOiBkMDtcbiAgICAgICAgdGhpcy5tb3ZlVG9vbFRpcCgpO1xuXG4gICAgfVxuXG4gICAgcHVibGljIG1vdmVUb29sVGlwKCkge1xuICAgICAgICBsZXQgZGlzdGFuY2lheDogbnVtYmVyO1xuICAgICAgICBpZiAodGhpcy5uZXd4U2NhbGUpIHtcbiAgICAgICAgICAgIHRoaXMuZm9jdXNcbiAgICAgICAgICAgIC5hdHRyKFxuICAgICAgICAgICAgICAgICd0cmFuc2Zvcm0nLFxuICAgICAgICAgICAgICAgIGB0cmFuc2xhdGUoJHt0aGlzLm5ld3hTY2FsZShcbiAgICAgICAgICAgICAgICAgICAgbmV3IERhdGUodGhpcy5kLnRpbWVzdGFtcCksXG4gICAgICAgICAgICAgICAgKX0sJHt0aGlzLm5ld3lTY2FsZSh0aGlzLmQucHJpY2UpfSlgKTtcblxuICAgICAgICAgICAgZGlzdGFuY2lheCA9IHRoaXMubmV3eFNjYWxlKG5ldyBEYXRlKHRoaXMuZC50aW1lc3RhbXApKTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdkaXN0YW5jaWF4OiAnLCBkaXN0YW5jaWF4KTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5mb2N1c1xuICAgICAgICAgICAgLmF0dHIoXG4gICAgICAgICAgICAgICAgJ3RyYW5zZm9ybScsXG4gICAgICAgICAgICAgICAgYHRyYW5zbGF0ZSgke3RoaXMuY2hhcnRQcm9wcy54U2NhbGUoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBEYXRlKHRoaXMuZC50aW1lc3RhbXApLFxuICAgICAgICAgICAgICAgICl9LCR7dGhpcy5jaGFydFByb3BzLnlTY2FsZSh0aGlzLmQucHJpY2UpfSlgKTtcblxuICAgICAgICAgICAgZGlzdGFuY2lheCA9IHRoaXMuY2hhcnRQcm9wcy54U2NhbGUobmV3IERhdGUodGhpcy5kLnRpbWVzdGFtcCkpO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2Rpc3RhbmNpYXg6ICcsIGRpc3RhbmNpYXgpO1xuXG4gICAgICAgIH1cblxuICAgICAgICAvKiBpZiAodGhpcy5kM2V2ZW50dHJhbnNmb3JtKSB7XG4gICAgICAgICAgdGhpcy5mb2N1cy5hdHRyKFxuICAgICAgICAgICAgJ3RyYW5zZm9ybScsXG4gICAgICAgICAgICB0aGlzLmQzZXZlbnR0cmFuc2Zvcm1cbiAgICAgICAgICApXG4gICAgICAgIH0gKi9cbiAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5jaGFydFByb3BzLnhTY2FsZShuZXcgRGF0ZShkLmRhdGUpKSk7XG5cbiAgICAgICAgdGhpcy50ZXh0VG9vbFRpcFxuICAgICAgICAudGV4dCh0aGlzLmdldERhdGFQb2ludC5iaW5kKHRoaXMpKTtcblxuICAgICAgICBjb25zdCB0eHROb2RlID0gdGhpcy50ZXh0VG9vbFRpcC5ub2RlKCkgYXMgU1ZHR0VsZW1lbnQ7XG5cbiAgICAgICAgY29uc3QgYmJveCA9IHR4dE5vZGUuZ2V0QkJveCgpO1xuXG4gICAgICAgIGlmIChiYm94LndpZHRoICsgMTAgPiBkaXN0YW5jaWF4KSB7XG4gICAgICAgICAgICB0aGlzLnRleHRUb29sVGlwXG4gICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnc3RhcnQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGV4dFRvb2xUaXBcbiAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdlbmQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZm9jdXMuc2VsZWN0QWxsKCdyZWN0JykucmVtb3ZlKCk7XG5cbiAgICAgICAgY29uc3QgcmVjdCA9IHRoaXMuZm9jdXNcbiAgICAgICAgICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgICAgICAgICAgLmF0dHIoJ3gnLCBiYm94LngpXG4gICAgICAgICAgICAuYXR0cigneScsIGJib3gueSlcbiAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIGJib3gud2lkdGgpXG4gICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgYmJveC5oZWlnaHQpXG4gICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnd2hpdGUnKVxuICAgICAgICAgICAgLnN0eWxlKCdmaWxsLW9wYWNpdHknLCAnLjknKVxuICAgICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCAnIzY2NicpXG4gICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZS13aWR0aCcsICcwLjVweCcpO1xuXG4gICAgICAgIHRoaXMuZm9jdXMubm9kZSgpLmluc2VydEJlZm9yZSh0eHROb2RlLCBudWxsKTtcblxuICAgICAgICBsZXQgbmV3eTIgPSAwO1xuXG4gICAgICAgIGlmICh0aGlzLm5ld3lTY2FsZSkge1xuICAgICAgICAgICAgbmV3eTIgPSB0aGlzLm5ld3lTY2FsZSh0aGlzLmQucHJpY2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3eTIgPSB0aGlzLmNoYXJ0UHJvcHMueVNjYWxlKHRoaXMuZC5wcmljZSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGVzY2FsbyBsYSBwb3NpY2lvbiB5MiBkZSBsYSBsw61uZWEgc2Vnw7puIGxhIG51ZXZhIGVzY2FsYSBzaSBzZSBoYSBoZWNobyB6b29tXG4gICAgICAgIHRoaXMuZm9jdXNcbiAgICAgICAgICAgIC5zZWxlY3QoJy54LWhvdmVyLWxpbmUnKVxuICAgICAgICAgICAgLmF0dHIoJ3kyJywgdGhpcy5oZWlnaHQgLSBuZXd5Mik7XG5cbiAgICAgICAgLy8gbm8gZnVuY2lvbmEgbGEgbGluZWEgaG9yaXpvbnRhbFxuICAgICAgICB0aGlzLmZvY3VzLnNlbGVjdCgnLnktaG92ZXItbGluZScpLmF0dHIoJ3gyJywgLSBkaXN0YW5jaWF4KTtcbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9